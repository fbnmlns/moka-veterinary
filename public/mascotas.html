<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="listaClientes.css">
    <link rel="stylesheet" href="forms-carlos.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://kit.fontawesome.com/f504b51584.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100&display=swap" rel="stylesheet">

    <title>Lista de Expedientes</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <style>
        th {
            color: #fff;
        }
    </style>
</head>

<body onload="cargarTabla()">
    <header class="header">
        <button class="menu-icon-btn" data-menu-icon-btn>
            <svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" class="menu-icon">
                <g>
                    <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path>
                </g>
            </svg>
        </button>
        <h1 class="titulo-pagina">Lista de Mascotas</h1>
    </header>
    <div class="container-aside">
        <aside class="sidebar" data-sidebar>
            <div class="top-nav">
                <a href="menu.html" class="moka-logo border"><img src="img/MOKA_ICON_2.png"
                        alt="Logo de Veterinaria Moka"></a>
                <div class="hidden-sidebar nombre-vet">Veterinaria Moka </div>
            </div>
            <div class="middle-sidebar">
                <ul class="sidebar-list">
                    <li class="sidebar-list-item active">
                        <a href="perfil.html" class="sidebar-link">
                            <svg xmlns="http://www.w3.org/2000/svg" class="sidebar-icon " width="24" height="24"
                                viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <circle cx="12" cy="12" r="9"></circle>
                                <circle cx="12" cy="10" r="3"></circle>
                                <path d="M6.168 18.849a4 4 0 0 1 3.832 -2.849h4a4 4 0 0 1 3.834 2.855"></path>
                            </svg>
                            <div class="hidden-sidebar">MI PERFIL</div>
                        </a>
                    </li>
                    <li class="sidebar-list-item">
                        <a href="citasVista.html" class="sidebar-link">
                            <svg xmlns="http://www.w3.org/2000/svg" class="sidebar-icon" width="24" height="24"
                                viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <rect x="4" y="5" width="16" height="16" rx="2"></rect>
                                <line x1="16" y1="3" x2="16" y2="7"></line>
                                <line x1="8" y1="3" x2="8" y2="7"></line>
                                <line x1="4" y1="11" x2="20" y2="11"></line>
                                <rect x="8" y="15" width="2" height="2"></rect>
                            </svg>
                            <div class="hidden-sidebar">CITAS</div>
                        </a>
                    </li>
                    <li class="sidebar-list-item">
                        <a href="reservaciones.html" class="sidebar-link">
                            <svg xmlns="http://www.w3.org/2000/svg" class="sidebar-icon" width="24" height="24"
                                viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <path d="M3.5 5.5l1.5 1.5l2.5 -2.5"></path>
                                <path d="M3.5 11.5l1.5 1.5l2.5 -2.5"></path>
                                <path d="M3.5 17.5l1.5 1.5l2.5 -2.5"></path>
                                <line x1="11" y1="6" x2="20" y2="6"></line>
                                <line x1="11" y1="12" x2="20" y2="12"></line>
                                <line x1="11" y1="18" x2="20" y2="18"></line>
                            </svg>
                            <div class="hidden-sidebar">RESERVACIONES</div>
                        </a>
                    </li>
                    <li class="sidebar-list-item">
                        <a href="Expediente00.html" class="sidebar-link">
                            <svg xmlns="http://www.w3.org/2000/svg" class="sidebar-icon" width="24" height="24"
                                viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <path
                                    d="M9 4h3l2 2h5a2 2 0 0 1 2 2v7a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2">
                                </path>
                                <path d="M17 17v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-9a2 2 0 0 1 2 -2h2"></path>
                            </svg>
                            <div class="hidden-sidebar">Expediente</div>
                        </a>
                    </li>
                    <li class="sidebar-list-item">
                        <a href="listaClientes.html" class="sidebar-link">
                            <svg xmlns="http://www.w3.org/2000/svg" class="sidebar-icon" width="24" height="24"
                                viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M3 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                <path d="M21 21v-2a4 4 0 0 0 -3 -3.85"></path>
                            </svg>
                            <div class="hidden-sidebar">CLIENTES</div>
                        </a>
                    </li>
                    <li class="sidebar-list-item">
                        <a href="Usuarios1.html" class="sidebar-link">
                            <svg xmlns="http://www.w3.org/2000/svg" class="sidebar-icon" width="24" height="24"
                                viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                <rect x="5" y="11" width="14" height="10" rx="2"></rect>
                                <circle cx="12" cy="16" r="1"></circle>
                                <path d="M8 11v-4a4 4 0 0 1 8 0v4"></path>
                            </svg>
                            <div class="hidden-sidebar">ADMIN</div>
                        </a>
                    </li>

                    <div class="bottom-sidebar log-out-pading">
                        <ul class="sidebar-list">
                            <li class="sidebar-list-item">
                                <a href="LoginWorker.html" class="sidebar-link">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="sidebar-icon" width="24" height="24"
                                        viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                        <path
                                            d="M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2">
                                        </path>
                                        <path d="M7 12h14l-3 -3m0 6l3 -3"></path>
                                    </svg>
                                    <div class="hidden-sidebar "> CERRAR SESION</div>
                                </a>
                            </li>
                        </ul>
                    </div>
        </aside>
        <main class="content">

            <div class="container1">
                <header class="txt-decoration">Mascotas</header>

                <form action="GET">

                    <div class="">
                        <!-- <div class="flex2">

                            <div class="fields">
                                <div class="input-field">
                                    <label>Nombre del Cliente</label>
                                    <input type="text" placeholder="" required>
                                </div>

                                <div class="input-field">
                                    <label>Correo Electr√≥nico</label>
                                    <input type="email" placeholder="" required>
                                </div>
                                <div class="input-field">
                                    <label>Cedula</label>
                                    <input type="number" placeholder="" required>
                                </div>
                                <div class="buttons-secondary">
                                    <button onclick="location.href = '#';" id="nextBtn"
                                        class="secondary-button nextBtn">Buscar
                                        <i class="fa-solid fa-magnifying-glass"></i></button>
                                </div>
                            </div>
                            <div class="buttons-secondary">
                                <button onclick="location.href = 'crearExpediente01.html';" id="nextBtn"
                                    class="secondary-button nextBtn">Crear Nuevo Expediente
                                    <i class="fa-solid fa-user-plus"></i></button>
                            </div>
                        </div> -->
                    </div>
                </form>
            </div>

            <div class="">
                <table class="table table-striped">
                    <tr class="bg-info">
                        <th>ID</th>
                        <th>Nombre Cliente</th>
                        <th>telefono</th>
                        <th>nombreMascota</th>
                        <th>Raza</th>
                        <th>Observaciones</th>
                        <th>imagen</th>
                        <th>Direccion</th>
                        <th>Fecha De Nacimiento</th>
                    </tr>

                    <tbody id="myTable">

                    </tbody>
                </table>
            </div>
        </main>
    </div>

</body>


<script>
     let params = (new URL(document.location)).searchParams;
         let clientId = params.get("clientId");
         let isEditable = params.get("isEdit");
    let pets_list = [];
    fetch(`http://localhost:5000/pets/${clientId}`, requestOptions)
        .then(response => response.json())
        .then(result => {
            // alert(result.data.msg)
            let pets = result.pets
            pets_list = [...pets]
            getPetsList()

        })
        .catch(error => console.log('error', error));

    var requestOptions = {
        method: 'GET',
    };

    function deleteRow(i) {


        fetch(`http://localhost:5000/pets/delete-pet/${pets_list[i].ID}`, {
            method: 'DELETE',
        })
            .then(response => response.json())
            .then(result => {
            
                window.location.reload()
            })
            .catch(error => console.log('error', error));


    }
    function updateRow(i) {

        window.location.href = `http://localhost:5000/crearExpediente02.html?petId=${pets_list[i].ID}&clientId=${pets_list[i].cliente}&isEdit=1`

}

function ViewRow(i) {

window.location.href = `http://localhost:5000/expedienteMedico.html?petId=${pets_list[i].ID}&clientId=${pets_list[i].cliente}`

}

    function getPetsList() {

        buildTable(pets_list)



        function buildTable(data) {
            var table = document.getElementById('myTable')

            for (var i = 0; i < data.length; i++) {
                var row = `<tr>
							<td>${i}</td>
							<td>${data[i]["Owner's name"]}</td>
							<td>${data[i]?.Telephone}</td>
                            <td>${data[i]?.nombreMascota}</td>
							<td>${data[i]?.raza}</td>
							<td>${data[i]?.observaciones}</td>
							<td><img style="width:50px;height:50px;"} src='http://localhost:5000/${data[i].imagen}'></td>
							<td>${data[i]?.Address}</td>
							<td>${data[i]?.fechaNacimiento}</td>
                            <td> 
                                <button onclick="updateRow(${i})"> <i class="fa-solid fa-edit"></i></button>
                                <button onclick="ViewRow(${i})"> <i class="fa fa-eye" aria-hidden="true"></i></button>
                            </td>
							
					  </tr>`
                table.innerHTML += row


            }
        }




    }





</script>
<script type="text/javascript" src="template.js"> </script>
<!-- <script type="text/javascript" src="script.js"> </script> -->
<script type="text/javascript" src="forms-carlos.js"> </script>

</html>